<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>WhatsApp...</title>
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1794075538175331');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1794075538175331&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->

  <script>
    // Lista de números posibles
    const numeros = [
      "5493518080905",
      "5493518081036",
      "5493515141625"
    ];

    // Selección aleatoria de uno
    const elegido = numeros[Math.floor(Math.random() * numeros.length)];

    // Código de origen (este es el identificador de este script)
    const origen = "1";

    // Generar código aleatorio de 5 dígitos
    const codigoTracking = Math.floor(10000 + Math.random() * 90000);

    // Mensaje con el código
    const mensaje = encodeURIComponent(
      `¡Hola! Quiero cargar mi Bono del 30% mi Código es: ${codigoTracking}`
    );

    // User-Agent y Referer para registro adicional (opcional)
    const userAgent = navigator.userAgent;
    const referer = document.referrer;

    // 📌 REEMPLAZÁ esta URL con la de tu Google Apps Script
    const scriptURL = "https://script.google.com/macros/s/AKfycbx1rcnsLVrtItTvsBrTHFz8oNIh0yaDfDwkLnWhDwqTT82eq1QBv3uGuvujLJg8HBU/exec";

    // Armar la URL para registrar
    const urlRegistro = `${scriptURL}?codigo=${codigoTracking}&origen=${origen}&numero=${encodeURIComponent(elegido)}&ua=${encodeURIComponent(userAgent)}&ref=${encodeURIComponent(referer)}`;

    // Guardar registro y redirigir
    fetch(urlRegistro)
      .then(() => {
        const urlWhatsApp = `https://wa.me/${elegido}?text=${mensaje}`;
        window.location.href = urlWhatsApp;
      })
      .catch(() => {
        // Igual redirigimos aunque falle el registro
        const urlWhatsApp = `https://wa.me/${elegido}?text=${mensaje}`;
        window.location.href = urlWhatsApp;
      });
  </script>
</head>
<body>
  <div style="text-align:center; font-family:sans-serif; margin-top:100px;">
    <h3>Conectando con un asesor por WhatsApp...</h3>
    <p>Por favor, no cierres esta ventana.</p>
  </div>
</body>
</html>
